<!DOCTYPE html>
<html>
<head>
    <title>Jorge's Website</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="My personal website. Includes bio, projects and contact information">
    <link href="images/doc.ico" rel="icon" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/formLayout.css">
    <script type="text/javascript" src="darkmode.js"></script>
</head>
<body onload="setMode()">
    <header>
        <h1>Jorge's Website</h1>
        <nav >
            <a href="/index.html">Home</a>
            <a href="/projects.html">Projects</a>  
            <a class="active" href="/button.html">Button and darkmode</a> 
        </nav> 

    </header>
    <section id="form"> 
        <h2> Form </h2>
        <button id="darkmode" onclick="toggle()">Dark mode</button>
        <form id="form1" action="https://httpbin.org/post" method="post">
            <div id="formArea">
                <label id="nameLabel" for="name">Name:</label><br>
                <input type="text" id="name" name="name" required><br>
                <output class="error" id="error1" name="error1" ></output> <output class="info" id="info1" name="info1"></output>

                <label id="emailLabel" for="email">E-mail:</label><br>
                <input type="email" id="email" name="email" required><br>
                <output class="error" id="error2" name="error2"></output> <output class="info" id="info2" name="info2"></output>

                <label id="commentsLabel" for="comments">Comments:</label><br>
                <textarea id="comments" name="comments" rows="4" cols="50" minlength="10" maxlength="100" onkeyup="countChar(this)" required></textarea><br />
                <output class="error" id="error3" name="error3"></output> <output class="info" id="info3" name="info3">Char count: 0/100</output>

                <input type="hidden" id="possible_bot" name="possible_bot" value="true">
                <input type="hidden" id="errors" name="errors">
                <input id="submit_btn" type="submit" value="Submit" onclick="submitForm()">
            </div>
        </form> 
        <script>
            const form_errors = [];
            function countChar(ta) {
                let charLen = ta.value.length;
                if(charLen>=90) {
                    let info3 = document.getElementById("info3");
                    info3.innerHTML = "Char count: "+charLen+"/100";
                    info3.style.color = "red";
                }
                let info3 = document.getElementById("info3");
                info3.innerHTML = "Char count: "+charLen+"/100";
            };

            function submitForm() {           
                    let name= document.getElementById("name");
                    if (!name.validity.valid) {
                        let error1 = document.getElementById("error1");
                        error1.innerHTML = "Please input a name";
                        error1.style.color = "red";
                        form_errors.push("User provided no name input");
                    }
                
                    let email= document.getElementById("email");
                    if (!email.checkValidity()) {
                        let error2 = document.getElementById("error2");
                        error2.innerHTML = "Please enter valid email";
                        error2.style.color = "red";
                        form_errors.push("User provided invalid email");
                    }
                
                    let comments = document.getElementById("comments");

                    let text = comments.value;
                    let re = new RegExp("[^;]+" );
                    if (re.test(text)) {
                        console.log("Valid");
                    } else {
                        let error3 = document.getElementById("error3");
                        error2.style.color = "red";
                        error3.innerHTML = "Invalid characters entered";
                        setTimeout(function() {
                            error3.innerHTML = "";
                        }, 5000);
                        form_errors.push("User entered invalid characters");
                    }
                    const arrToJSON = JSON.stringify(form_errors);
                    document.getElementById("errors").value= arrToJSON;
                
            } 
        </script>
    </section>
</body>